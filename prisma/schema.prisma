generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String
  name      String
  userType  UserType
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workoutPlans WorkoutPlan[]
  periods      Period[]
  sections     WorkoutSection[]
  settings     UserSettings?
  mainSports   UserMainSport[]
  workoutTemplates WorkoutTemplate[]

  // Legacy coach-athlete relationship (keeping for backward compatibility)
  athletes     CoachAthlete[] @relation("CoachAthletes")
  coaches      CoachAthlete[] @relation("AthleteCoaches")

  // New organizational structure - Admin/Owner relationships
  ownedCoachingGroups CoachingGroup[] @relation("CoachingGroupOwner")
  ownedTeams          Team[]          @relation("TeamOwner")
  ownedClubs          Club[]          @relation("ClubOwner")
  ownedGroups         Group[]         @relation("GroupOwner")

  // Membership relationships (user belongs to these entities)
  coachingGroupMemberships CoachingGroupMember[]
  teamMemberships          TeamMember[]
  clubMemberships          ClubMember[]
  groupMemberships         GroupMember[]
  
  // Action Planners
  actionPlanners          ActionPlanner[]

  @@map("users_new")
}

enum UserType {
  ATHLETE
  COACH
  TEAM_MANAGER
  CLUB_TRAINER
  GROUP_ADMIN
  ADMIN
}

// Translation System Models - New structure (legacy uses wide table format)
model Language {
  id           String        @id @default(cuid())
  code         String        @unique // ISO code: 'en', 'es', 'zh', etc.
  name         String        // Display name: 'English', 'Espa√±ol', etc.
  isActive     Boolean       @default(true)
  isDefault    Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  @@map("languages_new")
}

model Translation {
  id        String   @id @default(cuid())
  key       String
  language  String   @db.VarChar(10)
  value     String   @db.Text
  category  String   @default("general") @db.VarChar(50)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([key, language])
  @@map("translations")
}

model CoachAthlete {
  id        String   @id @default(cuid())
  coachId   String
  athleteId String
  notes     String?  // Coach's notes about this athlete
  createdAt DateTime @default(now())

  coach   User @relation("CoachAthletes", fields: [coachId], references: [id], onDelete: Cascade)
  athlete User @relation("AthleteCoaches", fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([coachId, athleteId])
  @@map("coach_athletes")
}

model WorkoutPlan {
  id        String   @id @default(cuid())
  userId    String
  name      String
  type      WorkoutPlanType
  startDate DateTime
  endDate   DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user  User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  weeks WorkoutWeek[]

  @@map("workout_plans")
}

enum WorkoutPlanType {
  CURRENT_WEEKS
  YEARLY_PLAN
  WORKOUTS_DONE
}

model WorkoutWeek {
  id            String   @id @default(cuid())
  workoutPlanId String
  weekNumber    Int
  createdAt     DateTime @default(now())

  workoutPlan WorkoutPlan @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)
  days        WorkoutDay[]

  @@map("workout_weeks")
}

model WorkoutDay {
  id           String   @id @default(cuid())
  workoutWeekId String
  date         DateTime
  weekNumber   Int
  dayOfWeek    Int
  periodId     String
  weather      String?
  feelingStatus String?
  notes        String?
  createdAt    DateTime @default(now())

  workoutWeek WorkoutWeek  @relation(fields: [workoutWeekId], references: [id], onDelete: Cascade)
  period      Period       @relation(fields: [periodId], references: [id], onDelete: Cascade)
  workouts    WorkoutSession[]

  @@map("workout_days")
}

model Period {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String
  color       String
  createdAt   DateTime @default(now())

  user   User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  days   WorkoutDay[]

  @@map("periods")
}

model WorkoutSession {
  id             String   @id @default(cuid())
  workoutDayId   String
  sessionNumber  Int
  name           String
  code           String
  time           String
  weather        String?
  location       String?
  surface        String?
  heartRateMax   Int?
  heartRateAvg   Int?
  calories       Int?
  feelingStatus  String?
  notes          String?
  status         WorkoutStatus
  createdAt      DateTime @default(now())

  workoutDay WorkoutDay @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)
  moveframes Moveframe[]
  sports     WorkoutSessionSport[]

  @@map("workout_sessions")
}

model WorkoutSessionSport {
  id               String   @id @default(cuid())
  workoutSessionId String
  sport            SportType

  workoutSession WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)

  @@map("workout_session_sports")
}

enum WorkoutStatus {
  NOT_PLANNED
  PLANNED_FUTURE
  PLANNED_NEXT_WEEK
  PLANNED_CURRENT_WEEK
  DONE_DIFFERENTLY
  DONE_LESS_75
  DONE_MORE_75
}

model Moveframe {
  id               String   @id @default(cuid())
  workoutSessionId String
  letter           String
  sport            SportType
  sectionId        String
  type             MoveframeType
  description      String
  createdAt        DateTime @default(now())

  workoutSession WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
  section        WorkoutSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  movelaps       Movelap[]

  @@map("moveframes")
}

enum MoveframeType {
  STANDARD
  BATTERY
  ANNOTATION
}

model WorkoutSection {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String
  color       String
  createdAt   DateTime @default(now())

  user       User @relation(fields: [userId], references: [id], onDelete: Cascade)
  moveframes Moveframe[]

  @@map("workout_sections")
}

model Movelap {
  id               String       @id @default(cuid())
  moveframeId      String
  repetitionNumber Int
  distance         Int?
  speed            String?
  style            String?
  pace             String?
  time             String?
  reps             Int?
  restType         RestType?
  pause            String?
  alarm            Int?
  sound            String?
  notes            String?
  status           MovelapStatus
  isSkipped        Boolean      @default(false)
  isDisabled       Boolean      @default(false)
  createdAt        DateTime     @default(now())

  moveframe Moveframe @relation(fields: [moveframeId], references: [id], onDelete: Cascade)

  @@map("movelaps")
}

enum RestType {
  SET_TIME
  RESTART_TIME
  RESTART_PULSE
}

enum MovelapStatus {
  PENDING
  COMPLETED
  SKIPPED
  DISABLED
}

enum SportType {
  SWIM
  BIKE
  RUN
  BODY_BUILDING
  ROWING
  SKATE
  GYMNASTIC
  STRETCHING
  PILATES
  SKI
  TECHNICAL_MOVES
  FREE_MOVES
}

model UserSettings {
  id            String @id @default(cuid())
  userId        String @unique
  
  // Color & Background Settings
  colorSettings String @db.Text // Store as JSON string, use TEXT for larger data
  
  // Display Settings
  gridSize      String @default("comfortable") // "compact", "comfortable", "spacious"
  columnCount   Int @default(3)
  rowHeight     String @default("medium") // "small", "medium", "large"
  defaultView   String @default("grid") // "list", "grid", "table"
  
  // Sidebar Settings
  leftSidebarVisible  Boolean @default(true)
  rightSidebarVisible Boolean @default(true)
  leftSidebarWidth    Int @default(20)
  rightSidebarWidth   Int @default(25)
  sidebarPosition     String @default("fixed") // "fixed", "floating"
  
  // Theme & Display
  theme         String @default("light") // "light", "dark", "auto", "time-based"
  fontSize      Int @default(16)
  iconSize      String @default("medium") // "small", "medium", "large"
  
  // Accessibility
  enableAnimations Boolean @default(true)
  reducedMotion    Boolean @default(false)
  highContrast     Boolean @default(false)
  
  // Performance
  performanceMode Boolean @default(false)
  imageQuality    String @default("high") // "low", "medium", "high"
  lazyLoading     Boolean @default(true)
  
  // Dashboard
  dashboardLayout String @default("default") // "default", "compact", "expanded"
  widgetArrangement String @default("[]") // JSON array of widget IDs
  
  // Language
  language      String @default("en")
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}

model UserMainSport {
  id     String    @id @default(cuid())
  userId String
  sport  SportType
  order  Int       @default(0)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, sport])
  @@map("user_main_sports")
}

// Workout Templates - Archive/Library for saving and reusing workouts
model WorkoutTemplate {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  category    String?  // "Swim", "Bike", "Run", "Mixed", "Strength", etc.
  tags        String?  // JSON array of tags for search/filter
  templateType String @default("workout") // "workout" or "day"
  
  // Template data stored as JSON
  // For "workout": { workoutSession: {...}, moveframes: [...], movelaps: [...] }
  // For "day": { day: {...}, workouts: [...], moveframes: [...], movelaps: [...] }
  templateData String  // JSON string
  
  // Metadata
  sports       String?  // Comma-separated list of sports in template
  totalDistance Int?    // Total distance in meters (if applicable)
  totalDuration Int?    // Total duration in minutes (if applicable)
  difficulty   String?  // "easy", "moderate", "hard", "extreme"
  
  isPublic     Boolean  @default(false) // Can be shared with other users
  isShared     Boolean  @default(false) // Shared by coach with athletes
  timesUsed    Int      @default(0)     // Track popularity
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([category])
  @@index([templateType])
  @@map("workout_templates")
}

// ===== NEW ORGANIZATIONAL STRUCTURE MODELS =====

// CoachingGroup: A coach can have multiple coaching groups
model CoachingGroup {
  id          String   @id @default(cuid())
  coachId     String
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  coach   User                    @relation("CoachingGroupOwner", fields: [coachId], references: [id], onDelete: Cascade)
  members CoachingGroupMember[]

  @@map("coaching_groups")
}

// Junction table: Athletes in coaching groups
model CoachingGroupMember {
  id               String   @id @default(cuid())
  coachingGroupId  String
  athleteId        String
  role             String?  // e.g., "athlete", "assistant"
  joinedAt         DateTime @default(now())

  coachingGroup CoachingGroup @relation(fields: [coachingGroupId], references: [id], onDelete: Cascade)
  athlete       User          @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([coachingGroupId, athleteId])
  @@map("coaching_group_members")
}

// Team: A team admin can manage multiple teams
model Team {
  id          String   @id @default(cuid())
  adminId     String
  name        String
  description String?
  sport       String?  // Primary sport for this team
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  admin   User         @relation("TeamOwner", fields: [adminId], references: [id], onDelete: Cascade)
  members TeamMember[]

  @@map("teams_new")
}

// Junction table: Athletes in teams
model TeamMember {
  id        String   @id @default(cuid())
  teamId    String
  athleteId String
  role      String?  // e.g., "captain", "player", "reserve"
  jerseyNumber Int?
  joinedAt  DateTime @default(now())

  team    Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  athlete User @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([teamId, athleteId])
  @@map("team_members_new")
}

// Club: A club admin can manage multiple clubs
model Club {
  id          String   @id @default(cuid())
  adminId     String
  name        String
  description String?
  location    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  admin   User         @relation("ClubOwner", fields: [adminId], references: [id], onDelete: Cascade)
  members ClubMember[]

  @@map("clubs_new")
}

// Junction table: Members in clubs
model ClubMember {
  id         String   @id @default(cuid())
  clubId     String
  memberId   String
  role       String?  // e.g., "member", "trainer", "staff"
  membershipType String? // e.g., "monthly", "annual"
  joinedAt   DateTime @default(now())

  club   Club @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member User @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([clubId, memberId])
  @@map("club_members_new")
}

// Group: A group admin can manage multiple groups
model Group {
  id          String   @id @default(cuid())
  adminId     String
  name        String
  description String?
  groupType   String?  // e.g., "fitness", "social", "competitive"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  admin   User          @relation("GroupOwner", fields: [adminId], references: [id], onDelete: Cascade)
  members GroupMember[]

  @@map("groups_new")
}

// Junction table: Users in groups
model GroupMember {
  id       String   @id @default(cuid())
  groupId  String
  userId   String
  role     String?  // e.g., "member", "moderator"
  joinedAt DateTime @default(now())

  group Group @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@map("group_members")
}

// Super Admin User - Full super admin account
model SuperAdmin {
  id        String   @id @default(cuid())
  username  String   @unique @db.VarChar(50)
  email     String   @unique
  password  String   // Hashed password using bcrypt
  name      String?  // Full name
  isActive  Boolean  @default(true)
  lastLogin DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("super_admins")
}

// Legacy: Super Admin Settings (kept for backward compatibility)
model SuperAdminSettings {
  id        String   @id @default(cuid())
  password  String   // Hashed password using bcrypt
  email     String?  // Optional: Super Admin email for recovery
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("super_admin_settings")
}

// Language-Specific Color Defaults
model ColorDefaults {
  id        String   @id @default(cuid())
  language  String   @unique @db.VarChar(10)
  data      Json     // Color settings as JSON
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("color_defaults")
}

// Language-Specific Tools Defaults
model ToolsDefaults {
  id        String   @id @default(cuid())
  language  String   @unique @db.VarChar(10)
  data      Json     // Tools data (periods, sections, sports, equipment, exercises)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tools_defaults")
}

// Language-Specific Favourites Defaults
model FavouritesDefaults {
  id        String   @id @default(cuid())
  language  String   @unique @db.VarChar(10)
  data      Json     // Favourites data (weeklyPlans, workouts, moveframes)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("favourites_defaults")
}

enum ActionPlannerCreateFrom {
  SCRATCH
  IMPORTED
}

model ActionPlanner {
  id          String        @id @default(cuid())
  userId      String
  username    String        @unique
  name        String
  surname     String
  fullName    String
  dateOfBirth DateTime
  email       String        @unique
  imageUrl    String?
  category    String?
  annotation  String?
  startDate   DateTime
  createFrom  ActionPlannerCreateFrom
  origin      String
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  user User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("action_planners")
}
