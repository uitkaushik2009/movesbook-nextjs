generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                       String                @id @default(cuid())
  email                    String                @unique
  username                 String                @unique
  password                 String
  name                     String
  userType                 UserType
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  birthdate                DateTime?
  country                  String?
  firstName                String?
  gender                   String?
  surname                  String?
  securityQuestion         String?
  securityAnswer           String?
  clubMemberships          ClubMember[]
  ownedClubs               Club[]                @relation("ClubOwner")
  coaches                  CoachAthlete[]        @relation("AthleteCoaches")
  athletes                 CoachAthlete[]        @relation("CoachAthletes")
  coachingGroupMemberships CoachingGroupMember[]
  ownedCoachingGroups      CoachingGroup[]       @relation("CoachingGroupOwner")
  favoriteWorkouts         FavoriteWorkout[]
  favoriteWeeklyPlans      FavoriteWeeklyPlan[]
  favoriteSports           FavoriteSport[]
  freeMoveExercises        FreeMoveExercise[]
  groupMemberships         GroupMember[]
  ownedGroups              Group[]               @relation("GroupOwner")
  periods                  Period[]
  teamMemberships          TeamMember[]
  ownedTeams               Team[]                @relation("TeamOwner")
  mainSports               UserMainSport[]
  settings                 UserSettings?
  workoutDays              WorkoutDay[]
  workoutPlans             WorkoutPlan[]
  sections                 WorkoutSection[]
  workoutTemplates         WorkoutTemplate[]

  @@map("users_new")
}

model Language {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String
  isActive  Boolean  @default(true)
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("languages_new")
}

model Translation {
  id        String   @id @default(cuid())
  key       String
  language  String   
  value     String   @db.Text
  category  String   @default("general") 
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@unique([key, language])
  @@map("translations")
}

model CoachAthlete {
  id        String   @id @default(cuid())
  coachId   String
  athleteId String
  notes     String?
  createdAt DateTime @default(now())
  athlete   User     @relation("AthleteCoaches", fields: [athleteId], references: [id], onDelete: Cascade)
  coach     User     @relation("CoachAthletes", fields: [coachId], references: [id], onDelete: Cascade)

  @@unique([coachId, athleteId])
  @@index([athleteId], map: "coach_athletes_athleteId_fkey")
  @@map("coach_athletes")
}

model WorkoutPlan {
  id          String          @id @default(cuid())
  userId      String
  name        String
  type        WorkoutPlanType
  storageZone String? // A, B, C to differentiate independent weekly plans
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  weeks       WorkoutWeek[]

  @@index([userId], map: "workout_plans_userId_fkey")
  @@map("workout_plans")
}

model WorkoutWeek {
  id            String       @id @default(cuid())
  workoutPlanId String
  weekNumber    Int
  createdAt     DateTime     @default(now())
  periodId      String?
  notes         String?      
  days          WorkoutDay[]
  period        Period?      @relation("WeekPeriod", fields: [periodId], references: [id])
  workoutPlan   WorkoutPlan  @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)

  @@index([periodId], map: "workout_weeks_periodId_fkey")
  @@index([workoutPlanId], map: "workout_weeks_workoutPlanId_fkey")
  @@map("workout_weeks")
}

model WorkoutDay {
  id                 String           @id @default(cuid())
  workoutWeekId      String
  date               DateTime
  weekNumber         Int
  dayOfWeek          Int
  periodId           String
  weather            String?
  feelingStatus      String?
  notes              String?          
  createdAt          DateTime         @default(now())
  userId             String
  assignedToUserId   String?
  creatorRole        UserType?
  isFromSharedSource Boolean          @default(false)
  originalSenderId   String?
  storageZone        StorageZone      @default(B)
  period             Period           @relation(fields: [periodId], references: [id], onDelete: Cascade)
  user               User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutWeek        WorkoutWeek      @relation(fields: [workoutWeekId], references: [id], onDelete: Cascade)
  workouts           WorkoutSession[]

  @@unique([userId, date, storageZone])
  @@index([userId, date])
  @@index([userId, storageZone, date])
  @@index([periodId], map: "workout_days_periodId_fkey")
  @@index([workoutWeekId], map: "workout_days_workoutWeekId_fkey")
  @@map("workout_days")
}

model Period {
  id          String        @id @default(cuid())
  userId      String
  name        String
  description String
  color       String
  createdAt   DateTime      @default(now())
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  days        WorkoutDay[]
  weeks       WorkoutWeek[] @relation("WeekPeriod")

  @@index([userId], map: "periods_userId_fkey")
  @@map("periods")
}

model WorkoutSession {
  id                String                @id @default(cuid())
  workoutDayId      String
  sessionNumber     Int
  name              String
  code              String
  time              String
  weather           String?
  location          String?
  surface           String?
  heartRateMax      Int?
  heartRateAvg      Int?
  calories          Int?
  feelingStatus     String?
  notes             String?
  status            WorkoutStatus
  createdAt         DateTime              @default(now())
  includeStretching Boolean               @default(true)
  mainSport         SportType?
  moveframes        Moveframe[]
  sports            WorkoutSessionSport[]
  workoutDay        WorkoutDay            @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)

  @@index([workoutDayId], map: "workout_sessions_workoutDayId_fkey")
  @@map("workout_sessions")
}

model WorkoutSessionSport {
  id               String         @id @default(cuid())
  workoutSessionId String
  sport            SportType
  workoutSession   WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)

  @@index([workoutSessionId], map: "workout_session_sports_workoutSessionId_fkey")
  @@map("workout_session_sports")
}

model Moveframe {
  id                  String         @id @default(cuid())
  workoutSessionId    String
  letter              String
  sport               SportType
  sectionId           String
  type                MoveframeType
  description         String         @db.Text
  createdAt           DateTime       @default(now())
  notes               String?        @db.Text        
  macroFinal          String?
  alarm               Int?
  annotationBgColor   String?
  annotationText      String?
  annotationTextColor String?
  annotationBold      Boolean?       @default(false)
  workType            WorkType?      @default(NONE)
  manualMode          Boolean?       @default(false)
  manualPriority      Boolean?       @default(false) // Priority flag for manual mode display
  favourite           Boolean?       @default(false)
  repetitions         Int?           // Number of series/repetitions for manual mode
  distance            Int?           // Distance value for manual mode
  section             WorkoutSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  workoutSession      WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
  movelaps            Movelap[]

  @@index([sectionId], map: "moveframes_sectionId_fkey")
  @@index([workoutSessionId], map: "moveframes_workoutSessionId_fkey")
  @@map("moveframes")
}

model WorkoutSection {
  id          String      @id @default(cuid())
  userId      String
  name        String
  code        String? // Short code (max 5 characters) for compact display
  description String
  color       String
  createdAt   DateTime    @default(now())
  moveframes  Moveframe[]
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "workout_sections_userId_fkey")
  @@map("workout_sections")
}

model Movelap {
  id               String        @id @default(cuid())
  moveframeId      String
  repetitionNumber Int
  distance         Int?
  speed            String?
  style            String?
  pace             String?
  time             String?
  rowPerMin        Int? // Row/min for ROWING sport (range 10-99)
  reps             Int?
  restType         RestType?
  pause            String?
  alarm            Int?
  sound            String?
  notes            String?        @db.Text
  status           MovelapStatus
  isSkipped        Boolean       @default(false)
  isDisabled       Boolean       @default(false)
  isNewlyAdded     Boolean       @default(false)
  createdAt        DateTime      @default(now())
  macroFinal       String?
  r1               String?
  r2               String?
  exercise         String?
  muscularSector   String?
  weight           String?
  tools            String?
  moveframe        Moveframe     @relation(fields: [moveframeId], references: [id], onDelete: Cascade)

  @@index([moveframeId], map: "movelaps_moveframeId_fkey")
  @@map("movelaps")
}

model UserSettings {
  id                     String    @id @default(cuid())
  userId                 String    @unique
  gridSize               String    @default("comfortable")
  columnCount            Int       @default(3)
  rowHeight              String    @default("medium")
  defaultView            String    @default("grid")
  leftSidebarVisible     Boolean   @default(true)
  rightSidebarVisible    Boolean   @default(true)
  leftSidebarWidth       Int       @default(20)
  rightSidebarWidth      Int       @default(25)
  sidebarPosition        String    @default("fixed")
  theme                  String    @default("light")
  fontSize               Int       @default(16)
  iconSize               String    @default("medium")
  enableAnimations       Boolean   @default(true)
  reducedMotion          Boolean   @default(false)
  highContrast           Boolean   @default(false)
  performanceMode        Boolean   @default(false)
  imageQuality           String    @default("high")
  lazyLoading            Boolean   @default(true)
  dashboardLayout        String    @default("default")
  widgetArrangement      String    @db.Text
  colorSettings          String    @db.Text
  language               String    @default("en")
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @default(now()) @updatedAt
  adminSettings          String    @db.Text
  favouritesSettings     String    @db.Text
  myBestSettings         String    @db.Text
  notificationSettings   String    @db.Text
  socialSettings         String    @db.Text
  sportIconType          String    @default("emoji")
  toolsSettings          String    @db.Text
  workoutPreferences     String    @db.Text
  yearlyPlanStartDate    DateTime? // Start date for Section B (Yearly Plan)
  templateWeeksStartDate DateTime? // Start date for Section A (3 Weeks Plan)
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}

model UserMainSport {
  id     String    @id @default(cuid())
  userId String
  sport  SportType
  order  Int       @default(0)
  user   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, sport])
  @@map("user_main_sports")
}

model WorkoutTemplate {
  id            String   @id @default(cuid())
  userId        String
  name          String
  description   String?
  category      String?
  tags          String?
  templateType  String   @default("workout")
  templateData  String   @db.Text
  sports        String?
  totalDistance Int?
  totalDuration Int?
  difficulty    String?
  isPublic      Boolean  @default(false)
  isShared      Boolean  @default(false)
  timesUsed     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([templateType])
  @@map("workout_templates")
}

model FavoriteWorkout {
  id            String   @id @default(cuid())
  userId        String
  name          String
  description   String?
  workoutData   String   @db.Text
  sports        String?
  totalDistance Int?
  totalDuration Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("favorite_workouts")
}

model FavoriteSport {
  id        String    @id @default(cuid())
  userId    String
  sport     SportType
  order     Int // 1-5 for ordering the favorites
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, sport])
  @@index([userId])
  @@map("favorite_sports")
}

model FavoriteWeeklyPlan {
  id            String   @id @default(cuid())
  userId        String
  name          String
  description   String?
  planData      String   @db.LongText // JSON snapshot of the weekly plan structure
  weeksCount    Int?
  daysCount     Int?
  workoutsCount Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("favorite_weekly_plans")
}

model FreeMoveExercise {
  id        String   @id @default(cuid())
  userId    String
  exercise  String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("free_move_exercises")
}

model CoachingGroup {
  id          String                @id @default(cuid())
  coachId     String
  name        String
  description String?
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  members     CoachingGroupMember[]
  coach       User                  @relation("CoachingGroupOwner", fields: [coachId], references: [id], onDelete: Cascade)

  @@index([coachId], map: "coaching_groups_coachId_fkey")
  @@map("coaching_groups")
}

model CoachingGroupMember {
  id              String        @id @default(cuid())
  coachingGroupId String
  athleteId       String
  role            String?
  joinedAt        DateTime      @default(now())
  athlete         User          @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  coachingGroup   CoachingGroup @relation(fields: [coachingGroupId], references: [id], onDelete: Cascade)

  @@unique([coachingGroupId, athleteId])
  @@index([athleteId], map: "coaching_group_members_athleteId_fkey")
  @@map("coaching_group_members")
}

model Team {
  id          String       @id @default(cuid())
  adminId     String
  name        String
  description String?
  sport       String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  members     TeamMember[]
  admin       User         @relation("TeamOwner", fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId], map: "teams_new_adminId_fkey")
  @@map("teams_new")
}

model TeamMember {
  id           String   @id @default(cuid())
  teamId       String
  athleteId    String
  role         String?
  jerseyNumber Int?
  joinedAt     DateTime @default(now())
  athlete      User     @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  team         Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, athleteId])
  @@index([athleteId], map: "team_members_new_athleteId_fkey")
  @@map("team_members_new")
}

model Club {
  id          String       @id @default(cuid())
  adminId     String
  name        String
  description String?
  location    String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  members     ClubMember[]
  admin       User         @relation("ClubOwner", fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId], map: "clubs_new_adminId_fkey")
  @@map("clubs_new")
}

model ClubMember {
  id             String   @id @default(cuid())
  clubId         String
  memberId       String
  role           String?
  membershipType String?
  joinedAt       DateTime @default(now())
  club           Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  member         User     @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([clubId, memberId])
  @@index([memberId], map: "club_members_new_memberId_fkey")
  @@map("club_members_new")
}

model Group {
  id          String        @id @default(cuid())
  adminId     String
  name        String
  description String?
  groupType   String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  members     GroupMember[]
  admin       User          @relation("GroupOwner", fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId], map: "groups_new_adminId_fkey")
  @@map("groups_new")
}

model GroupMember {
  id       String   @id @default(cuid())
  groupId  String
  userId   String
  role     String?
  joinedAt DateTime @default(now())
  group    Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([userId], map: "group_members_userId_fkey")
  @@map("group_members")
}

model SuperAdmin {
  id        String    @id @default(cuid())
  username  String    @unique 
  email     String    @unique
  password  String
  name      String?
  isActive  Boolean   @default(true)
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("super_admins")
}

model SuperAdminSettings {
  id        String   @id @default(cuid())
  password  String
  email     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("super_admin_settings")
}

model ColorDefaults {
  id        String   @id @default(cuid())
  language  String   @unique 
  data      String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("color_defaults")
}

model ToolsDefaults {
  id        String   @id @default(cuid())
  language  String   @unique 
  data      String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tools_defaults")
}

model FavouritesDefaults {
  id        String   @id @default(cuid())
  language  String   @unique 
  data      String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("favourites_defaults")
}

model MyBestDefaults {
  id        String   @id @default(cuid())
  language  String   @unique 
  data      String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("mybest_defaults")
}

model GridDefaults {
  id        String   @id @default(cuid())
  language  String   @unique 
  data      String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("grid_defaults")
}

enum UserType {
  ATHLETE
  COACH
  TEAM
  TEAM_MANAGER
  CLUB
  CLUB_TRAINER
  GROUP
  GROUP_ADMIN
  ADMIN
}

enum WorkoutPlanType {
  TEMPLATE_WEEKS // Section A: 3 generic template weeks (no dates)
  CURRENT_WEEKS // Legacy - being replaced by TEMPLATE_WEEKS
  YEARLY_PLAN // Section B: Full year plan with start date
  WORKOUTS_DONE // Section C: Completed workouts
  ARCHIVE // Section D: Archived workouts
}

enum StorageZone {
  A
  B
  C
  D
}

enum WorkoutStatus {
  NOT_PLANNED
  PLANNED_FUTURE
  PLANNED_NEXT_WEEK
  PLANNED_CURRENT_WEEK
  DONE_DIFFERENTLY
  DONE_LESS_75
  DONE_MORE_75
}

enum MoveframeType {
  STANDARD
  BATTERY
  ANNOTATION
}

enum WorkType {
  NONE
  MAIN
  SECONDARY
}

enum RestType {
  SET_TIME
  RESTART_TIME
  RESTART_PULSE
}

enum MovelapStatus {
  PENDING
  COMPLETED
  SKIPPED
  DISABLED
}

enum SportType {
  SWIM
  BIKE
  SPINNING
  RUN
  BODY_BUILDING
  ROWING
  SKATE
  GYMNASTIC
  STRETCHING
  PILATES
  YOGA
  SKI
  SNOWBOARD
  TECHNICAL_MOVES
  FREE_MOVES
  SOCCER
  BASKETBALL
  TENNIS
  VOLLEYBALL
  GOLF
  BOXING
  MARTIAL_ARTS
  CLIMBING
  HIKING
  WALKING
  DANCING
  CALISTENIC
  CROSSFIT
  SPARTAN
  TRIATHLON
  TRACK_FIELD
}
